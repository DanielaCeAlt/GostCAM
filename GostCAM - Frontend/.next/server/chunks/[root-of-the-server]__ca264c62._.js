module.exports=[18622,(e,o,t)=>{o.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,o,t)=>{o.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,o,t)=>{o.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},52360,(e,o,t)=>{o.exports=e.x("mysql2/promise",()=>require("mysql2/promise"))},84168,e=>{"use strict";e.s(["executeQuery",()=>a,"getCatalogos",()=>c,"getConnection",()=>s,"getEquiposCompletos",()=>n,"getMovimientosDetallados",()=>l,"testConnection",()=>i]);var o=e.i(52360);let t={host:process.env.DB_HOST||"localhost",port:parseInt(process.env.DB_PORT||"3306"),user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"GostCAM",charset:"utf8mb4",timezone:"+00:00"},r=o.default.createPool({...t,waitForConnections:!0,connectionLimit:10,queueLimit:0}),s=async()=>{try{return await r.getConnection()}catch(e){throw console.error("Error connecting to the database:",e),Error("Failed to connect to database")}},a=async(e,o=[])=>{let t;try{t=await s();let[r]=await t.execute(e,o);return r}catch(t){throw console.error("Database query error:",t),console.error("Query:",e),console.error("Params:",o),t}finally{t&&t.release()}},i=async()=>{try{return(await a("SELECT 1 as test")).length>0}catch(e){return console.error("Database connection test failed:",e),!1}},n=async e=>u(e),u=async e=>{let o=`
    SELECT 
      e.no_serie,
      e.nombreEquipo,
      e.numeroActivo,
      e.modelo,
      e.fechaAlta,
      e.idPosicion,
      te.nombreTipo as TipoEquipo,
      ee.estatus as EstatusEquipo,
      'Centro Principal' as SucursalActual,
      u.NombreUsuario as UsuarioAsignado
    FROM equipo e
    LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo
    LEFT JOIN estatusequipo ee ON e.idEstatus = ee.idEstatus
    LEFT JOIN usuarios u ON e.idUsuarios = u.idUsuarios
  `,t=[],r=[];if(r.push("(e.eliminado IS NULL OR e.eliminado = 0)"),e&&(e.tipoEquipo&&(r.push("te.nombreTipo = ?"),t.push(e.tipoEquipo)),e.estatus&&(r.push("ee.estatus = ?"),t.push(e.estatus)),e.usuario&&(r.push("u.NombreUsuario LIKE ?"),t.push(`%${e.usuario}%`)),e.busqueda)){r.push(`(
        e.nombreEquipo LIKE ? OR 
        e.no_serie LIKE ? OR 
        e.numeroActivo LIKE ? OR
        e.modelo LIKE ? OR
        te.nombreTipo LIKE ? OR
        ee.estatus LIKE ? OR
        u.NombreUsuario LIKE ?
      )`);let o=`%${e.busqueda}%`;t.push(o,o,o,o,o,o,o)}return r.length>0&&(o+=" WHERE "+r.join(" AND ")),o+=" ORDER BY e.fechaAlta DESC",await a(o,t)},l=async e=>{let o="SELECT * FROM VistaMovimientosDetallados",t=[],r=[];return e&&(e.sucursalOrigen&&(r.push("SucursalOrigen = ?"),t.push(e.sucursalOrigen)),e.sucursalDestino&&(r.push("SucursalDestino = ?"),t.push(e.sucursalDestino)),e.tipoMovimiento&&(r.push("tipoMovimiento = ?"),t.push(e.tipoMovimiento)),e.estatusMovimiento&&(r.push("estatusMovimiento = ?"),t.push(e.estatusMovimiento)),e.fechaDesde&&(r.push("fecha >= ?"),t.push(e.fechaDesde)),e.fechaHasta&&(r.push("fecha <= ?"),t.push(e.fechaHasta))),r.length>0&&(o+=" WHERE "+r.join(" AND ")),a(o+=" ORDER BY fecha DESC",t)},c=async()=>{try{console.log("Obteniendo catÃ¡logos...");let e=async(e,o=[])=>{try{return await a(e)}catch(t){return console.warn(`Query failed: ${e}`,t),o}},o=await e("SELECT * FROM usuarios",[]),t=await e("SELECT * FROM tipoequipo",[]),r=await e("SELECT * FROM estatusequipo",[]),s=await e("SELECT * FROM posiciones",[{id:1,nombre:"Entrada Principal"},{id:2,nombre:"RecepciÃ³n"},{id:3,nombre:"Oficina"}]),i=await e('SELECT DISTINCT SucursalActual as nombre, SucursalActual as id FROM equipos WHERE SucursalActual IS NOT NULL AND SucursalActual != ""',[{id:"SUC001",nombre:"Sucursal Principal"},{id:"SUC002",nombre:"Sucursal Norte"},{id:"SUC003",nombre:"Sucursal Sur"}]);return{tiposEquipo:t,estatusEquipos:r,usuarios:o,posiciones:s,sucursales:i,estados:[],municipios:[],zonas:[]}}catch(e){throw console.error("Error obteniendo catÃ¡logos:",e),e}}},12851,(e,o,t)=>{},55261,e=>{"use strict";e.s(["handler",()=>N,"patchFetch",()=>y,"routeModule",()=>v,"serverHooks",()=>w,"workAsyncStorage",()=>f,"workUnitAsyncStorage",()=>O],55261);var o=e.i(47909),t=e.i(74017),r=e.i(96250),s=e.i(59756),a=e.i(61916),i=e.i(69741),n=e.i(16795),u=e.i(87718),l=e.i(95169),c=e.i(47587),p=e.i(66012),d=e.i(70101),E=e.i(26937),m=e.i(10372),R=e.i(93695);e.i(52474);var h=e.i(220);e.s(["GET",()=>x,"POST",()=>T,"PUT",()=>C],13992);var g=e.i(89171),q=e.i(84168);async function x(e){try{console.log("API Equipos GET llamada");let{searchParams:o}=new URL(e.url),t={sucursal:o.get("sucursal")||void 0,tipoEquipo:o.get("tipoEquipo")||void 0,estatus:o.get("estatus")||void 0,usuario:o.get("usuario")||void 0,busqueda:o.get("busqueda")||void 0};Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),console.log("Filtros aplicados:",t);let r=await (0,q.getEquiposCompletos)(t);return g.NextResponse.json({success:!0,data:r,message:"Equipos obtenidos exitosamente"},{status:200})}catch(e){return console.error("Error obteniendo equipos:",e),g.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}async function T(e){try{let o=await e.json(),t=o.noSerie||o.no_serie,r=o.idUsuarios||o.usuarioAsignado;for(let{campo:e,valor:r}of(console.log("ðŸ“¦ Datos recibidos para crear equipo:",o),[{campo:"noSerie",valor:t},{campo:"nombreEquipo",valor:o.nombreEquipo},{campo:"modelo",valor:o.modelo},{campo:"idTipoEquipo",valor:o.idTipoEquipo},{campo:"idEstatus",valor:o.idEstatus},{campo:"idSucursal",valor:o.idSucursal}]))if(!r)return console.log(`âŒ Campo faltante: ${e}`,r),g.NextResponse.json({success:!1,error:`El campo ${e} es requerido`,message:"Datos incompletos"},{status:400});let s=async e=>{let o=await (0,q.executeQuery)(`
        SELECT TipoEquipo 
        FROM (
          SELECT ROW_NUMBER() OVER (ORDER BY TipoEquipo) as rownum, TipoEquipo
          FROM (SELECT DISTINCT TipoEquipo FROM GostCAM.VistaEquiposCompletos WHERE TipoEquipo IS NOT NULL) tipos
        ) t 
        WHERE rownum = ?
      `,[e]);return o.length>0?o[0].TipoEquipo:""},a=async e=>{if(console.log(`ðŸ” Mapeando sucursal ID/C\xf3digo: ${e} (tipo: ${typeof e})`),!e)return console.log("âŒ ID de sucursal vacÃ­o, usando fallback"),1;try{let o;if("string"==typeof e)o=e,console.log(`ðŸ“ Usando c\xf3digo de centro directamente: ${o}`);else{let t=await (0,q.executeQuery)(`
            SELECT idCentro, Sucursal
            FROM (
              SELECT ROW_NUMBER() OVER (ORDER BY Sucursal) as rownum, idCentro, Sucursal
              FROM sucursales
            ) s 
            WHERE rownum = ?
          `,[e]);if(0===t.length)return console.log(`âŒ No se encontr\xf3 sucursal con ID ${e}`),1;o=t[0].idCentro,console.log(`ðŸ“ ID ${e} mapeado a centro: ${o}`)}let t=await (0,q.executeQuery)(`
          SELECT p.idPosicion, p.NombrePosicion, s.Sucursal
          FROM posicionequipo p 
          JOIN sucursales s ON p.idCentro = s.idCentro
          WHERE p.idCentro = ?
          ORDER BY p.idPosicion
          LIMIT 1
        `,[o]);if(t.length>0){let e=t[0].idPosicion;return console.log(`âœ… Posici\xf3n asignada: ${e} (${t[0].NombrePosicion}) en ${t[0].Sucursal}`),e}return console.log("âŒ No se encontrÃ³ posiciÃ³n para el centro"),1}catch(e){return console.error("âŒ Error en mapearSucursal:",e),1}},i=async e=>{if(!e)return 1;if("number"==typeof e)return console.log(`âœ… Usuario ID recibido: ${e}`),e;try{let o=(await (0,q.executeQuery)(`
          SELECT ROW_NUMBER() OVER (ORDER BY UsuarioAsignado) as rownum, UsuarioAsignado
          FROM (
            SELECT DISTINCT UsuarioAsignado 
            FROM GostCAM.VistaEquiposCompletos 
            WHERE UsuarioAsignado IS NOT NULL AND UsuarioAsignado != ''
          ) usuarios
          ORDER BY UsuarioAsignado
        `)).find(o=>o.UsuarioAsignado.toLowerCase()===e.toLowerCase());if(o)return console.log(`âœ… Usuario "${e}" mapeado a ID: ${o.rownum}`),o.rownum;return console.log(`âš ï¸ Usuario "${e}" no encontrado, usando ID por defecto`),1}catch(e){return console.error("âŒ Error en mapearUsuario:",e),1}},n=async e=>{let o=await (0,q.executeQuery)(`
        SELECT EstatusEquipo 
        FROM (
          SELECT ROW_NUMBER() OVER (ORDER BY EstatusEquipo) as rownum, EstatusEquipo
          FROM (SELECT DISTINCT EstatusEquipo FROM GostCAM.VistaEquiposCompletos WHERE EstatusEquipo IS NOT NULL) estatus
        ) e 
        WHERE rownum = ?
      `,[e]);return o.length>0?o[0].EstatusEquipo:""};console.log("ðŸ“¥ Datos recibidos - idSucursal:",o.idSucursal,"tipo:",typeof o.idSucursal);let u=await s(parseInt(o.idTipoEquipo)),l=await a(o.idSucursal),c=await i(r),p=await n(parseInt(o.idEstatus));if(console.log("ðŸ“Š Mapeos realizados:"),console.log("- Tipo Equipo:",o.idTipoEquipo,"->",u),console.log("- idPosicion calculada:",l),console.log("- Usuario:",r,"->",c),console.log("- Estatus:",o.idEstatus,"->",p),console.log("ðŸ“¦ Datos a insertar:"),console.log("- No. Serie:",t),console.log("- Nombre Equipo:",o.nombreEquipo),console.log("- Modelo:",o.modelo),console.log("- Tipo Equipo ID:",o.idTipoEquipo,"(",u,")"),console.log("- Estatus ID:",o.idEstatus,"(",p,")"),console.log("- Usuario ID:",c),console.log("- PosiciÃ³n ID:",l),(await (0,q.executeQuery)("SELECT no_serie FROM Equipo WHERE no_serie = ?",[t])).length>0)return g.NextResponse.json({success:!1,error:"El nÃºmero de serie ya existe",message:"No se puede crear el equipo"},{status:409});let d=`
      INSERT INTO Equipo (
        no_serie, nombreEquipo, modelo, numeroActivo, 
        idTipoEquipo, idEstatus, idUsuarios, idPosicion
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `,E=[t,o.nombreEquipo,o.modelo,o.numeroActivo||t,o.idTipoEquipo,o.idEstatus,c,l];return await (0,q.executeQuery)(d,E),console.log("âœ… Equipo creado exitosamente"),g.NextResponse.json({success:!0,data:{no_serie:t,mensaje:"Equipo insertado correctamente"},message:"Equipo creado exitosamente"},{status:201})}catch(e){return console.error("ðŸ’¥ Error creando equipo:",e),g.NextResponse.json({success:!1,error:"Error interno del servidor",details:e instanceof Error?e.message:"Error desconocido",message:"No se pudo crear el equipo"},{status:500})}}async function C(e){try{let o=await e.json(),{no_serie:t}=o;if(!t)return g.NextResponse.json({success:!1,error:"NÃºmero de serie es requerido"},{status:400});let r=await (0,q.executeQuery)("SELECT no_serie FROM Equipo WHERE no_serie = ?",[t]);if(0===r.length)return g.NextResponse.json({success:!1,error:"Equipo no encontrado"},{status:404});let s=[],a=[];if(o.nombreEquipo&&(s.push("nombreEquipo = ?"),a.push(o.nombreEquipo)),o.modelo&&(s.push("modelo = ?"),a.push(o.modelo)),o.idTipoEquipo&&(s.push("idTipoEquipo = ?"),a.push(parseInt(o.idTipoEquipo))),o.idEstatus&&(s.push("idEstatus = ?"),a.push(parseInt(o.idEstatus))),o.idSucursal&&(s.push("idSucursal = ?"),a.push(parseInt(o.idSucursal))),o.idUsuarios&&(s.push("idUsuarios = ?"),a.push(parseInt(o.idUsuarios))),0===s.length)return g.NextResponse.json({success:!1,error:"No hay campos para actualizar"},{status:400});return a.push(t),await (0,q.executeQuery)(`
      UPDATE Equipos 
      SET ${s.join(", ")}
      WHERE no_serie = ?
    `,a),g.NextResponse.json({success:!0,message:"Equipo actualizado exitosamente"},{status:200})}catch(e){return console.error("Error actualizando equipo:",e),g.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}var S=e.i(13992);let v=new o.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/equipos/route",pathname:"/api/equipos",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/equipos/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:f,workUnitAsyncStorage:O,serverHooks:w}=v;function y(){return(0,r.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:O})}async function N(e,o,r){var g;let q="/api/equipos/route";q=q.replace(/\/index$/,"")||"/";let x=await v.prepare(e,o,{srcPage:q,multiZoneDraftMode:!1});if(!x)return o.statusCode=400,o.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:T,params:C,nextConfig:S,isDraftMode:f,prerenderManifest:O,routerServerContext:w,isOnDemandRevalidate:y,revalidateOnlyGenerated:N,resolvedPathname:b}=x,A=(0,i.normalizeAppPath)(q),I=!!(O.dynamicRoutes[A]||O.routes[b]);if(I&&!f){let e=!!O.routes[b],o=O.dynamicRoutes[A];if(o&&!1===o.fallback&&!e)throw new R.NoFallbackError}let D=null;!I||v.isDev||f||(D="/index"===(D=b)?"/":D);let U=!0===v.isDev||!I,M=I&&!U,L=e.method||"GET",P=(0,a.getTracer)(),_=P.getActiveScopeSpan(),j={params:C,prerenderManifest:O,renderOpts:{experimental:{cacheComponents:!!S.experimental.cacheComponents,authInterrupts:!!S.experimental.authInterrupts},supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(g=S.experimental)?void 0:g.cacheLife,isRevalidate:M,waitUntil:r.waitUntil,onClose:e=>{o.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(o,t,r)=>v.onRequestError(e,o,r,w)},sharedContext:{buildId:T}},F=new n.NodeNextRequest(e),H=new n.NodeNextResponse(o),$=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(o));try{let i=async t=>v.handle($,j).finally(()=>{if(!t)return;t.setAttributes({"http.status_code":o.statusCode,"next.rsc":!1});let r=P.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let e=`${L} ${s}`;t.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),t.updateName(e)}else t.updateName(`${L} ${e.url}`)}),n=async a=>{var n,u;let l=async({previousCacheEntry:t})=>{try{if(!(0,s.getRequestMeta)(e,"minimalMode")&&y&&N&&!t)return o.statusCode=404,o.setHeader("x-nextjs-cache","REVALIDATED"),o.end("This page could not be found"),null;let n=await i(a);e.fetchMetrics=j.renderOpts.fetchMetrics;let u=j.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let l=j.renderOpts.collectedTags;if(!I)return await (0,p.sendResponse)(F,H,n,j.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),o=(0,d.toNodeOutgoingHttpHeaders)(n.headers);l&&(o[m.NEXT_CACHE_TAGS_HEADER]=l),!o["content-type"]&&e.type&&(o["content-type"]=e.type);let t=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,r=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:o},cacheControl:{revalidate:t,expire:r}}}}catch(o){throw(null==t?void 0:t.isStale)&&await v.onRequestError(e,o,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:M,isOnDemandRevalidate:y})},w),o}},R=await v.handleResponse({req:e,nextConfig:S,cacheKey:D,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:y,revalidateOnlyGenerated:N,responseGenerator:l,waitUntil:r.waitUntil});if(!I)return null;if((null==R||null==(n=R.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==R||null==(u=R.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,s.getRequestMeta)(e,"minimalMode")||o.setHeader("x-nextjs-cache",y?"REVALIDATED":R.isMiss?"MISS":R.isStale?"STALE":"HIT"),f&&o.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,d.fromNodeOutgoingHttpHeaders)(R.value.headers);return(0,s.getRequestMeta)(e,"minimalMode")&&I||g.delete(m.NEXT_CACHE_TAGS_HEADER),!R.cacheControl||o.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,E.getCacheControlHeader)(R.cacheControl)),await (0,p.sendResponse)(F,H,new Response(R.value.body,{headers:g,status:R.value.status||200})),null};_?await n(_):await P.withPropagatedContext(e.headers,()=>P.trace(l.BaseServerSpan.handleRequest,{spanName:`${L} ${e.url}`,kind:a.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},n))}catch(o){if(o instanceof R.NoFallbackError||await v.onRequestError(e,o,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:M,isOnDemandRevalidate:y})}),I)throw o;return await (0,p.sendResponse)(F,H,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ca264c62._.js.map